<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>EmployeeController.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Ezloans-spring (02-Oct-2023 5:06:51 pm)</a> &gt; <a href="../../index.html" class="el_group">Ezloans-spring</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">com.wellsfargo.training.ezloans.controller</a> &gt; <span class="el_source">EmployeeController.java</span></div><h1>EmployeeController.java</h1><pre class="source lang-java linenums">package com.wellsfargo.training.ezloans.controller;

import java.time.LocalDate;
import java.util.Calendar;
import java.util.Date;
import java.util.Map;
import java.util.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import com.wellsfargo.training.ezloans.exception.ResourceNotFoundException;
import com.wellsfargo.training.ezloans.model.Employee;
import com.wellsfargo.training.ezloans.model.EmployeeCard;
import com.wellsfargo.training.ezloans.model.EmployeeIssue;
import com.wellsfargo.training.ezloans.model.Item;
import com.wellsfargo.training.ezloans.model.LoanCard;
import com.wellsfargo.training.ezloans.service.EmployeeCardService;
import com.wellsfargo.training.ezloans.service.EmployeeIssueService;
import com.wellsfargo.training.ezloans.service.EmployeeService;
import com.wellsfargo.training.ezloans.service.ItemService;
import com.wellsfargo.training.ezloans.service.LoanCardService;

@CrossOrigin(origins=&quot;http://localhost:3000&quot;)
@RestController
@RequestMapping(value=&quot;/api&quot;)
<span class="fc" id="L36">public class EmployeeController {</span>
	/* This class is designed to handle all request to the Employee Service */
	@Autowired
	public EmployeeService eservice;

	@Autowired
	public EmployeeCardService ecardservice;
	
	@Autowired
	public ItemService iservice;
	
	@Autowired
	public EmployeeIssueService eissueservice;
	/* We use dependency injection to created required service class objects*/
	
	@Autowired
	public LoanCardService lcardservice;
	
	/* Employee Register - this method is used to createUser and save in the database*/
	@PostMapping(&quot;/empreg&quot;)
	public ResponseEntity&lt;String&gt; createUser(@Validated @RequestBody Employee employee){
		try {
			
<span class="fc" id="L59">			Employee emp=eservice.registerEmployee(employee);</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">			if(emp!=null) {</span>
<span class="fc" id="L61">				return ResponseEntity.ok(&quot;Registration Successfull&quot;);</span>
			}
			else
<span class="fc" id="L64">				return ResponseEntity.badRequest().body(&quot;Registration Failed&quot;);</span>
		}
<span class="fc" id="L66">		catch(Exception e) {</span>
<span class="fc" id="L67">			return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)</span>
<span class="fc" id="L68">					.body(&quot;An Error has Occured: &quot;+ e.getMessage());</span>
		}
	}
	

// http://localhost:8085/ezloans/api/login
	/*
	 * {
  
    &quot;password&quot;:&quot;admin&quot;,
    &quot;email&quot;:&quot;admin@ezloans.com&quot;
}
	 */
	//This function enable the login functionality
	@PostMapping(&quot;/login&quot;)
	public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; loginEmployee(@Validated @RequestBody Employee employee) throws ResourceNotFoundException {
		
<span class="nc" id="L85">		Boolean isloggedin=false;</span>
		
<span class="nc" id="L87">		String email=employee.getEmail();</span>
<span class="nc" id="L88">		String password=employee.getPassword();</span>
		
		//We fetch an existing employee up with the given email id
<span class="nc" id="L91">		Employee emp=eservice.loginEmployee(email).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;Employee not found for this email&quot;));</span>
		//we compare the employee email and the password
<span class="nc bnc" id="L93" title="All 4 branches missed.">		if(email.equals(employee.getEmail())&amp;&amp;password.equals(emp.getPassword())){</span>
<span class="nc" id="L94">			isloggedin=true;</span>
			
		}

<span class="nc" id="L98">		Map&lt;String,Object&gt; response = new HashMap&lt;String, Object&gt;();</span>
<span class="nc" id="L99">		response.put(&quot;isloggedin&quot;,isloggedin);</span>
<span class="nc" id="L100">		response.put(&quot;eid&quot;,emp.getEid());</span>
<span class="nc" id="L101">		return ResponseEntity.ok(response);</span>
		
		//return a custom JSON response to the frontend service for login
		
	}
	

	/*
	 * {
    &quot;eid&quot;:103,
    &quot;category&quot;:&quot;Stationary&quot;,
    &quot;description&quot;:&quot;Register&quot;,
    &quot;value&quot;:10,
    &quot;make&quot;:&quot;yes&quot;
}
	 */
	
	/*This is the  apply loan functionality for the employee class*/
	@PostMapping(&quot;/applyloan&quot;)
	public ResponseEntity&lt;String&gt; applyLoan(@Validated @RequestBody Map&lt;String, String&gt; requestMap) throws ResourceNotFoundException {
		
<span class="nc" id="L122">		Long eid=Long.parseLong(requestMap.get(&quot;eid&quot;));</span>
<span class="nc" id="L123">		String itemCategory=requestMap.get(&quot;category&quot;);</span>
<span class="nc" id="L124">		String itemDescription=requestMap.get(&quot;description&quot;);</span>
<span class="nc" id="L125">		Long itemValue=Long.parseLong(requestMap.get(&quot;value&quot;));</span>
<span class="nc" id="L126">		String itemMake=requestMap.get(&quot;make&quot;);</span>
<span class="nc" id="L127">		Date issueDate=new Date();</span>
		
		/*In this try block , we fetch an employee id , a load card obj , set the duration , create an EmployeeCard and push it in database*/
		try {
<span class="nc" id="L131">			Employee employeeobj=eservice.getEmployee(eid).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;employee id not present&quot;));</span>
			
<span class="nc" id="L133">			LoanCard loancardobj=lcardservice.getLoanCardByType(itemCategory).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;Loan Card could not be found by type&quot;));</span>
			
<span class="nc" id="L135">			int duration=loancardobj.getDuration();</span>
			
<span class="nc" id="L137">			Calendar calendar=Calendar.getInstance();</span>
<span class="nc" id="L138">			calendar.setTime(issueDate);</span>
			
<span class="nc" id="L140">			calendar.add(Calendar.DAY_OF_YEAR, duration);</span>
			
<span class="nc" id="L142">			Date returnDate=calendar.getTime();			</span>
<span class="nc" id="L143">			EmployeeCard empcard=EmployeeCard.builder().employee(employeeobj).loanId(loancardobj).issueDate(issueDate).build();</span>
			
<span class="nc" id="L145">			EmployeeCard empcardcreated=ecardservice.addEmployeeCard(empcard);</span>
			
<span class="nc" id="L147">			Item item=iservice.getItemByDesc(itemDescription).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;Item not found by description&quot;));</span>
			
			
<span class="nc" id="L150">			EmployeeIssue empissue=EmployeeIssue.builder().employee(employeeobj).issueDate(issueDate).returnDate(returnDate).item(item).build();</span>
			
<span class="nc" id="L152">			EmployeeIssue empissuecreated=eissueservice.registerEmployeeIssue(empissue);</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">			if(empissuecreated!=null) {</span>
<span class="nc" id="L154">					return ResponseEntity.ok(&quot;Loan Successfully applied&quot;);</span>
			}
			else {
				
<span class="nc" id="L158">					return ResponseEntity.badRequest().body(&quot;Loan not applied successfully&quot;);</span>
			}
		}
<span class="nc" id="L161">		catch(Exception e) {</span>
			
			//On failure we raise an exception and set the response entity status to Internal Server Error
<span class="nc" id="L164">			return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)</span>
<span class="nc" id="L165">					.body(&quot;An Error has Occured: &quot;+ e.getMessage());</span>
		}
		

		
		
	}



	// GET: http://localhost:8085/ezloans/api/employee
	/*This is  a simple get mapping function to pull all employee records from the database */
	@GetMapping(&quot;/employee&quot;)
	public ResponseEntity&lt; List&lt;Employee&gt;&gt; getAllEmployees() {
		
		try {
<span class="nc" id="L181">			List&lt;Employee&gt; employees =  eservice.listAll();</span>
<span class="nc" id="L182">			return ResponseEntity.ok(employees);</span>
<span class="nc" id="L183">			} catch(Exception e) {</span>
				//On  failure we raise exception and print the stack trace
<span class="nc" id="L185">				e.printStackTrace();</span>
<span class="nc" id="L186">				return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(null);</span>
				}
	}
	
	// GET: http://localhost:8085/ezloans/api/employee/1001
	
	// This function pulls Employee records based on matching Employee ID
	@GetMapping(&quot;/employee/{id}&quot;)
	public ResponseEntity&lt;Employee&gt; getEmployeesById(@PathVariable(value=&quot;id&quot;) long eid) 
			throws ResourceNotFoundException{
<span class="pc" id="L196">		Employee e=eservice.getSingleEmployee(eid).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;Employee not found for this id &quot;+eid));</span>
<span class="fc" id="L197">		return ResponseEntity.ok().body(e);</span>
	}
	
	// PUT: http://localhost:8085/ezloans/api/employee/1001
	
	//This function is used to update records of an given employee , specified by there ID.
	@PutMapping(&quot;/employee/{id}&quot;)
	public ResponseEntity&lt;Employee&gt; updateEmployee(@PathVariable(value=&quot;id&quot;) long eid, @Validated @RequestBody Employee e) 
			throws ResourceNotFoundException{
<span class="pc" id="L206">		Employee employee=eservice.getSingleEmployee(eid).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;Employee not found for this id &quot;+eid));</span>
		
<span class="fc" id="L208">		employee.setFname(e.getFname());</span>
<span class="fc" id="L209">		employee.setLname(e.getLname());</span>
<span class="fc" id="L210">		employee.setEmail(e.getEmail());</span>
<span class="fc" id="L211">		employee.setGender(e.getGender());</span>
<span class="fc" id="L212">		employee.setDesignation(e.getDesignation());</span>
<span class="fc" id="L213">		employee.setDepartment(e.getDepartment());</span>
<span class="fc" id="L214">		employee.setDob(e.getDob());</span>
<span class="fc" id="L215">		employee.setDoj(e.getDoj());</span>
		
<span class="fc" id="L217">		final Employee updatedEmployee = eservice.saveEmployee(employee);</span>
<span class="fc" id="L218">		return ResponseEntity.ok().body(updatedEmployee);</span>
		
	}
	
	// http://localhost:8085/ezloans/api/employee/1001
	
	//This function is used to delete a specific employee record , identified by the given Employee ID
	@DeleteMapping(&quot;/employee/{id}&quot;)
	public ResponseEntity&lt;Map&lt;String, Boolean&gt;&gt;  deleteEmployee(@PathVariable(value=&quot;id&quot;) long eid)
	throws ResourceNotFoundException {
		
<span class="nc" id="L229">		eservice.getSingleEmployee(eid).orElseThrow(()-&gt;new ResourceNotFoundException(&quot;Employee not found for this id &quot;+eid));</span>
<span class="nc" id="L230">		eservice.deleteEmployee(eid);</span>
		
<span class="nc" id="L232">		Map&lt;String,Boolean&gt; response = new HashMap&lt;String, Boolean&gt;();</span>
<span class="nc" id="L233">		response.put(&quot;Deleted&quot;,Boolean.TRUE);</span>
<span class="nc" id="L234">		return ResponseEntity.ok(response);		</span>
	}

}

/*
 * 
 Sample POST request for http://localhost:8085/ezloans/api/empreg
 {
    &quot;fname&quot;: &quot;Jane&quot;,
    &quot;lname&quot;: &quot;Doe&quot;,
    &quot;email&quot;: &quot;jane@ezloans.com&quot;,
    &quot;password&quot;:&quot;password&quot;,
    &quot;designation&quot;: &quot;Program Associate&quot;,
    &quot;department&quot;: &quot;DTI&quot;,
    &quot;gender&quot;: &quot;Female&quot;,
    &quot;dob&quot;: &quot;2000-10-02&quot;,
    &quot;doj&quot;: &quot;2021-11-19&quot;
}

Sample POST for http://localhost:8085/ezloans/api/login

{
    &quot;password&quot;:&quot;admin&quot;,
    &quot;email&quot;:&quot;admin@ezloans.com&quot;
}
	 
 * */
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span>Ezloans-spring (02-Oct-2023 5:06:51 pm)</div></body></html>